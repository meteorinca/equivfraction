<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fraction Chef: Equivalent Fractions</title>
    <style>
        :root {
            --primary: #ff7e5f;
            --secondary: #feb47b;
            --success: #2ecc71;
            --dark: #2c3e50;
        }

        body {
            font-family: 'Comic Sans MS', 'Chalkboard SE', cursive;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            margin: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            color: var(--dark);
        }

        .header {
            background: white;
            width: 100%;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
        }

        .difficulty-select {
            padding: 10px;
            border-radius: 20px;
            border: 2px solid var(--primary);
            font-size: 1rem;
            outline: none;
            cursor: pointer;
        }

        .app-container {
            max-width: 1000px;
            width: 95%;
            margin: 20px auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px;
            border-radius: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            text-align: center;
        }

        .question-text {
            font-size: 1.5rem;
            margin-bottom: 30px;
        }

        .visual-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .fraction-card {
            background: white;
            padding: 20px;
            border-radius: 20px;
            border: 3px solid #eee;
            transition: all 0.2s;
            position: relative;
        }

        .shape-container {
            width: 200px;
            height: 200px;
            margin: 0 auto 15px;
            position: relative;
            background-size: cover;
            background-position: center;
            border-radius: 50%;
            overflow: visible; /* Ensure SVG can be seen */
        }

        .shape-container.square {
            border-radius: 10px;
        }

        .fraction-overlay {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10; /* Force to front */
            cursor: pointer;
            overflow: visible;
        }

        /* Slice Styling */
        .slice {
            fill: rgba(255, 255, 255, 0.2); /* Very light so image shows through */
            stroke: rgba(0,0,0,0.6);
            stroke-width: 1.5;
            transition: all 0.2s;
            pointer-events: all !important; /* CRITICAL FIX */
        }

        .slice:hover {
            fill: rgba(255, 255, 255, 0.5);
        }

        .slice.active {
            fill: rgba(255, 215, 0, 0.7) !important; /* Golden color */
            stroke: #d35400;
            stroke-width: 3;
        }

        .input-group {
            font-size: 1.5rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .fraction-input {
            width: 60px;
            text-align: center;
            font-size: 1.5rem;
            border: 3px solid #ddd;
            border-radius: 8px;
            margin-bottom: 5px;
            font-family: inherit;
        }

        .fraction-line {
            width: 70px;
            height: 3px;
            background: var(--dark);
            margin-bottom: 5px;
        }

        .denominator-text {
            font-weight: bold;
            color: var(--primary);
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        button {
            padding: 12px 30px;
            border-radius: 50px;
            border: none;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            font-weight: bold;
        }

        .btn-check { background: var(--success); color: white; }
        .btn-next { background: var(--primary); color: white; opacity: 0.5; cursor: not-allowed; }
        .btn-next.enabled { opacity: 1; cursor: pointer; }

        .correct-anim { border-color: var(--success) !important; background: #e8f8f5; }
        .wrong-anim { border-color: #e74c3c !important; background: #fdedec; }

        #feedback-msg {
            margin-top: 20px;
            font-size: 1.3rem;
            font-weight: bold;
            height: 30px;
        }
    </style>
</head>
<body>

<div class="header">
    <h1 id="rank-display">üçï Kitchen Helper</h1>
    <div>
        Difficulty: 
        <select class="difficulty-select" id="diff-select" onchange="initGame()">
            <option value="easy">Easy (1/2, 1/4)</option>
            <option value="medium">Medium (1/3, 1/6)</option>
            <option value="hard">Hard (Any Denominator)</option>
        </select>
    </div>
</div>

<div class="app-container">
    <div id="game-stage">
        <div class="question-text" id="target-text"></div>
        <div class="visual-grid" id="visual-grid"></div>
    </div>

    <div id="feedback-msg"></div>

    <div class="controls">
        <button class="btn-check" onclick="validate()">Check My Cooking!</button>
        <button class="btn-next" id="next-btn" onclick="initGame()" disabled>Next Order</button>
    </div>
</div>

<script>
    const diffSettings = {
        easy: { denominators: [2, 4, 8] },
        medium: { denominators: [3, 6, 9, 12] },
        hard: { denominators: [4, 5, 8, 10, 12, 15, 16] }
    };

    const assets = [
        { type: 'circle', img: 'pizza.png' },
        { type: 'circle', img: 'cookie.png' },
        { type: 'square', img: 'browniepan.png' }
    ];

    let currentQuestion = {};
    let score = 0;

    function initGame() {
        document.getElementById('next-btn').disabled = true;
        document.getElementById('next-btn').classList.remove('enabled');
        document.getElementById('feedback-msg').innerHTML = "";
        generateRandomQuestion();
    }

    function generateRandomQuestion() {
        const diff = document.getElementById('diff-select').value;
        const denoms = diffSettings[diff].denominators;
        
        // Pick a base denominator and a target numerator
        const d1 = denoms[Math.floor(Math.random() * denoms.length)];
        const n1 = Math.ceil(Math.random() * (d1 - 1));
        const ratio = n1 / d1;

        // Find denominators that support this ratio
        let possibleEquivs = [];
        for(let i=2; i<=16; i++) {
            if ((i * ratio) % 1 === 0 && i !== d1) {
                possibleEquivs.push(i);
            }
        }

        // Shuffle and pick 2 alternatives. If none, double/triple the base.
        possibleEquivs.sort(() => 0.5 - Math.random());
        const d2 = possibleEquivs[0] || d1 * 2;
        const d3 = possibleEquivs[1] || (possibleEquivs[0] ? possibleEquivs[1] : d1 * 3);

        currentQuestion = {
            target: { n: n1, d: d1 },
            options: [
                { d: d1, n_correct: n1 },
                { d: d2, n_correct: Math.round(ratio * d2) },
                { d: d3, n_correct: Math.round(ratio * d3) }
            ]
        };

        renderQuestion();
    }

    function renderQuestion() {
        const grid = document.getElementById('visual-grid');
        document.getElementById('target-text').innerHTML = `Chef! Prepare 3 trays that equal <strong>${currentQuestion.target.n}/${currentQuestion.target.d}</strong>`;
        grid.innerHTML = "";

        currentQuestion.options.forEach((opt, index) => {
            const asset = assets[index % assets.length];
            const card = document.createElement('div');
            card.className = 'fraction-card';
            card.id = `card-${index}`;

            const shapeContainer = document.createElement('div');
            shapeContainer.className = `shape-container ${asset.type}`;
            shapeContainer.style.backgroundImage = `url('${asset.img}')`;
            shapeContainer.style.backgroundColor = '#f3e5ab'; // Fallback color

            const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
            svg.setAttribute("viewBox", "0 0 100 100");
            svg.setAttribute("class", "fraction-overlay");
            svg.setAttribute("width", "200");
            svg.setAttribute("height", "200");

            if(asset.type === 'circle') {
                createCircleSlices(svg, opt.d);
            } else {
                createSquareSlices(svg, opt.d);
            }

            shapeContainer.appendChild(svg);
            card.appendChild(shapeContainer);
            
            card.innerHTML += `
                <div class="input-group">
                    <input type="number" class="fraction-input" id="input-${index}" placeholder="?">
                    <div class="fraction-line"></div>
                    <div class="denominator-text">${opt.d}</div>
                </div>
            `;
            
            grid.appendChild(card);
        });
    }

    function createCircleSlices(svg, den) {
        const centerX = 50, centerY = 50, radius = 50;
        for (let i = 0; i < den; i++) {
            const sA = (i * 2 * Math.PI) / den - Math.PI/2;
            const eA = ((i + 1) * 2 * Math.PI) / den - Math.PI/2;
            const x1 = centerX + radius * Math.cos(sA);
            const y1 = centerY + radius * Math.sin(sA);
            const x2 = centerX + radius * Math.cos(eA);
            const y2 = centerY + radius * Math.sin(eA);
            
            const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
            path.setAttribute("d", `M 50 50 L ${x1} ${y1} A 50 50 0 0 1 ${x2} ${y2} Z`);
            path.setAttribute("class", "slice");
            path.addEventListener('click', function(e) {
                this.classList.toggle('active');
            });
            svg.appendChild(path);
        }
    }

    function createSquareSlices(svg, den) {
        let cols = Math.ceil(Math.sqrt(den));
        if (den === 6) cols = 3;
        if (den === 8) cols = 4;
        if (den === 10) cols = 5;
        if (den === 12) cols = 4;

        const rows = Math.ceil(den / cols);
        const w = 100 / cols;
        const h = 100 / rows;

        for (let i = 0; i < den; i++) {
            const r = Math.floor(i / cols);
            const c = i % cols;
            const rect = document.createElementNS("http://www.w3.org/2000/svg", "rect");
            rect.setAttribute("x", c * w);
            rect.setAttribute("y", r * h);
            rect.setAttribute("width", w);
            rect.setAttribute("height", h);
            rect.setAttribute("class", "slice");
            rect.addEventListener('click', function(e) {
                this.classList.toggle('active');
            });
            svg.appendChild(rect);
        }
    }

    function validate() {
        let allCorrect = true;
        currentQuestion.options.forEach((opt, i) => {
            const inputVal = parseInt(document.getElementById(`input-${i}`).value);
            const card = document.getElementById(`card-${i}`);
            const activeSlices = card.querySelectorAll('.slice.active').length;

            if (inputVal === opt.n_correct && activeSlices === opt.n_correct) {
                card.className = 'fraction-card correct-anim';
            } else {
                card.className = 'fraction-card wrong-anim';
                allCorrect = false;
            }
        });

        const feedback = document.getElementById('feedback-msg');
        if (allCorrect) {
            feedback.innerHTML = "üåü Perfect Service! You earned a Star!";
            feedback.style.color = "var(--success)";
            document.getElementById('next-btn').disabled = false;
            document.getElementById('next-btn').classList.add('enabled');
            updateRank();
        } else {
            feedback.innerHTML = "Chef, some trays don't look right. Double check!";
            feedback.style.color = "#e74c3c";
        }
    }

    function updateRank() {
        score++;
        let rank = "Kitchen Helper";
        if (score > 3) rank = "Pizza Apprentice";
        if (score > 7) rank = "Pastry Sous Chef";
        if (score > 12) rank = "Master Fraction Chef";
        document.getElementById('rank-display').innerHTML = `üçï ${rank} (Level ${score})`;
    }

    window.onload = initGame;
</script>
</body>
</html>
